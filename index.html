<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç‹å®¶ç¿çš„ç•™è¨€æ¿ä¸ç®€ä»‹</title> <!-- ä¿®æ”¹æ ‡é¢˜ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYftoevTnczZimCLzzJujqFqBXcReMvt8",
      authDomain: "metalphon-7ed49.firebaseapp.com",
      projectId: "metalphon-7ed49",
      storageBucket: "metalphon-7ed49.appspot.com",
      messagingSenderId: "965453822169",
      appId: "1:965453822169:web:8ea6ec693243af8892e6c8",
      measurementId: "G-Y6LN2HHHH7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUser = null;
    let loadingAnimationElement = null;

    function showLoading() {
      if (loadingAnimationElement) loadingAnimationElement.style.display = "flex";
    }

    function hideLoading() {
      if (loadingAnimationElement) loadingAnimationElement.style.display = "none";
    }


    window.startChat = () => {
      const nameInput = document.getElementById("nickname").value.trim();
      if (nameInput) {
        currentUser = nameInput;
        document.getElementById("welcome-section").style.display = "none";
        document.getElementById("profile-section").style.display = "block"; // æ˜¾ç¤ºç®€ä»‹
        document.getElementById("chat-section").style.display = "block";    // æ˜¾ç¤ºèŠå¤©
        document.getElementById("welcome-name").textContent = currentUser;
        loadMessages();
      } else {
        alert("è¯·è¾“å…¥ä½ çš„æ˜µç§°ï¼");
      }
    };

    window.submitMessage = async () => {
      const input = document.getElementById("message-input");
      const message = input.value.trim();

      if (!currentUser) {
        alert("è¯·å…ˆè¿›å…¥ç•™è¨€æ¿ï¼ˆè®¾ç½®æ˜µç§°ï¼‰ã€‚");
        return;
      }
      if (!message) {
        alert("ç•™è¨€å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
        return;
      }

      showLoading(); 
      const messagesContainer = document.getElementById("messages");
      messagesContainer.innerHTML = ''; 

      try {
        await addDoc(collection(db, "messages"), {
          user: currentUser,
          content: message,
          timestamp: serverTimestamp() 
        });
        input.value = "";
      } catch (error) {
        console.error("Error adding document: ", error);
        alert("å‘é€ç•™è¨€å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚");
        hideLoading(); 
      } finally {
        loadMessages(); 
      }
    };

    window.loadMessages = async () => {
      const container = document.getElementById("messages");
      showLoading(); 

      try {
        const q = query(collection(db, "messages"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        let html = "";
        if (querySnapshot.empty) {
          html = "<p>è¿˜æ²¡æœ‰ç•™è¨€ï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</p>";
        } else {
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp && data.timestamp.toDate ? data.timestamp.toDate().toLocaleString('zh-CN') : 'å‘é€ä¸­...'; // ä½¿ç”¨ä¸­æ–‡åŒºåŸŸè®¾ç½®
            html += `
              <div class="message-item">
                <strong class="message-user">${data.user || "åŒ¿å"}</strong>
                <span class="message-timestamp">(${date})</span>ï¼š
                <span class="message-content">${data.content}</span>
              </div>
            `;
          });
        }
        container.innerHTML = html;
      } catch (error) {
        console.error("Error loading messages: ", error);
        container.innerHTML = "<p style='color:red;'>åŠ è½½ç•™è¨€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•ã€‚</p>";
      } finally {
        hideLoading(); 
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
        loadingAnimationElement = document.getElementById("loading-animation");
    });

  </script>

  <style>
    body {
      min-height: 100vh;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #a5b4fc 0%, #b39ddb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', 'Arial', sans-serif;
    }
    .center-bg {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .form {
      --background: #d3d3d3;
      --input-focus: #2d8cf0;
      --font-color: #323232;
      --font-color-sub: #666;
      --bg-color: #fff;
      --main-color: #323232;
      padding: 20px;
      background: var(--background);
      display: flex;
      flex-direction: column;
      align-items: center; /* å±…ä¸­ */
      justify-content: center;
      gap: 20px;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      box-shadow: 4px 4px var(--main-color);
    }
    .form > p {
      color: var(--font-color);
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .form > p > span {
      color: var(--font-color-sub);
      font-weight: 600;
      font-size: 17px;
    }
    .separator {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .separator > div {
      width: 100px;
      height: 3px;
      border-radius: 5px;
      background-color: var(--font-color-sub);
    }
    .separator > span {
      color: var(--font-color);
      font-weight: 600;
    }
    .oauthButton {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
      width: 250px;
      height: 40px;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      background-color: var(--bg-color);
      box-shadow: 4px 4px var(--main-color);
      font-size: 16px;
      font-weight: 600;
      color: var(--font-color);
      cursor: pointer;
      transition: all 250ms;
      position: relative;
      overflow: hidden;
      z-index: 1;
      padding: 0 15px;
    }
    .oauthButton::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0;
      background-color: #212121;
      z-index: -1;
      box-shadow: 4px 8px 19px -3px rgba(0, 0, 0, 0.27);
      transition: all 250ms;
    }
    .oauthButton:hover {
      color: #e8e8e8;
    }
    .oauthButton:hover::before {
      width: 100%;
    }
    .form > input {
      width: 250px;
      height: 40px;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      background-color: var(--bg-color);
      box-shadow: 4px 4px var(--main-color);
      font-size: 15px;
      font-weight: 600;
      color: var(--font-color);
      padding: 5px 10px;
      outline: none;
    }
    .icon {
      width: 1.5rem;
      height: 1.5rem;
    }
    .hero-bg {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0; left: 0;
      z-index: 0;
    }
    .hero-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(60,60,120,0.18);
      padding: 3rem 2.5rem 2.5rem 2.5rem;
      text-align: center;
      max-width: 420px;
      width: 100%;
      animation: fadeInUp 1s;
      z-index: 1;
    }
    .avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      margin-bottom: 1.2rem;
      box-shadow: 0 2px 8px rgba(99,102,241,0.18);
      border: 4px solid #a5b4fc;
      object-fit: cover;
    }
    h1 {
      font-size: 2.2rem;
      color: #4f46e5;
      margin-bottom: 0.5rem;
      font-weight: 800;
      letter-spacing: 1px;
    }
    .subtitle {
      font-size: 1.1rem;
      color: #6366f1;
      margin-bottom: 0.8rem;
    }
    .intro {
      color: #374151;
      margin-bottom: 1.5rem;
      font-size: 1rem;
    }
    .input-label {
        display: block;
        margin-bottom: 0.5rem;
        color: #333;
        font-weight: bold;
        text-align: left;
    }
    .input {
      width: calc(100% - 22px); 
      padding: 10px; 
      margin-top: 4px; 
      margin-bottom: 16px; 
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .input:focus {
        border-color: #4f46e5;
        outline: none;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
    }
    .btn {
      background: linear-gradient(90deg, #6366f1 0%, #4f46e5 100%);
      color: white;
      padding: 10px 20px; 
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 2px 8px rgba(99,102,241,0.12);
    }
    .btn:hover {
      background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
      transform: translateY(-2px) scale(1.04);
    }
    .btn:active {
        background: #3730a3;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    /* è®©åç»­å†…å®¹ä¸å—å…¨å±èƒŒæ™¯å½±å“ */
    #profile-section, #chat-section {
      position: relative;
      z-index: 2;
    }
    .card {
      width: 100%;
      max-width: 600px; 
      margin: 1rem auto;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* ç®€ä»‹éƒ¨åˆ†çš„ç‰¹å®šæ ·å¼ */
    #profile-section h2 {
        color: #4f46e5; /* ä¸æŒ‰é’®é¢œè‰²å‘¼åº” */
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 0.5rem;
    }
    #profile-section p {
        margin-bottom: 0.8rem;
        line-height: 1.6;
        color: #374151;
    }
    #profile-section strong {
        color: #1f2937;
    }

    #messages {
        margin-top: 1.5rem;
        max-height: 300px; /* è°ƒæ•´é«˜åº¦ä¸ºç®€ä»‹è…¾å‡ºç©ºé—´ */
        overflow-y: auto; 
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        background-color: #f9fafb;
        min-height: 50px; 
    }

    .message-item {
      margin-bottom: 0.75rem; 
      padding: 0.75rem;
      border-radius: 0.5rem;
      background-color: #ffffff; 
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      border-left: 4px solid #4f46e5; 
    }
    .message-user {
        font-weight: bold;
        color: #374151;
    }
    .message-timestamp {
        font-size: 0.8rem;
        color: #6b7280;
        margin-left: 0.5rem;
    }
    .message-content {
        display: block; 
        margin-top: 0.25rem;
        color: #1f2937;
        word-wrap: break-word; 
    }

    /* Loading Animation Styles */
    .loader {
      --ANIMATION-DELAY-MULTIPLIER: 70ms;
      padding: 0;
      margin: 20px auto; 
      display: none; 
      flex-direction: row;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      height: 50px; 
    }
    .loader span {
      padding: 0;
      margin: 0;
      letter-spacing: -5rem;
      animation-delay: 0s;
      transform: translateY(4rem);
      animation: hideAndSeek 1s alternate infinite cubic-bezier(0.86, 0, 0.07, 1);
    }
    .loader .l { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 0); }
    .loader .o { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 1); }
    .loader .a { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 2); }
    .loader .d { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 3); }
    .loader .ispan { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 4); }
    .loader .n { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 5); }
    .loader .g { animation-delay: calc(var(--ANIMATION-DELAY-MULTIPLIER) * 6); }
    .letter { width: fit-content; height: 3rem; }
    .ispan .letter { margin-inline: 5px; }
    @keyframes hideAndSeek {
      0% { transform: translateY(4rem); }
      100% { transform: translateY(0rem); }
    }

    #particles-js {
      position: absolute;
      width: 100vw;
      height: 100vh;
      top: 0; left: 0;
      z-index: 0;
    }
    .hero-card {
      position: relative;
      z-index: 2;
    }
    .hero-bg {
      position: relative;
      z-index: 1;
    }
    .pixel-bg {
      position: fixed;
      width: 100vw;
      height: 100vh;
      left: 0; top: 0;
      pointer-events: none;
      z-index: 0;
    }
    .pixel-board {
      position: absolute;
      opacity: 0.7;
    }
    .pixel-board-tl { left: 2vw; top: 2vh; transform: rotate(-10deg);}
    .pixel-board-br { right: 2vw; bottom: 2vh; transform: rotate(12deg);}
    .pixel-board-tr { right: 8vw; top: 8vh; transform: rotate(6deg);}
    .pixel-board-bl { left: 8vw; bottom: 8vh; transform: rotate(-7deg);}
    .chip-wall-bg, .chip-wall-grid, .chip-svg { display: none !important; }
    #matrix-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      background: #000;
      opacity: 1;
    }
    .center-bg, .form, #welcome-section, #profile-section, #chat-section {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>
  <canvas id="matrix-bg"></canvas>
  <div class="center-bg">
    <form action="javascript:void(0);" class="form" id="welcome-section">
      <img src="https://api.dicebear.com/7.x/miniavs/svg?seed=ç‹å®¶ç¿" class="avatar" alt="å¤´åƒ" style="margin-bottom: 1rem;" />
      <p style="margin-bottom:0;">
        ç‹å®¶ç¿çš„ä¸ªäººç®€å†
        <span>æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸“å±ç©ºé—´</span>
      </p>
      <div class="intro" style="text-align:center; color:#374151; font-size:15px; margin-bottom:0;">
        é‡åº†ç†å·¥å¤§å­¦ Â· ç”µå­ä¿¡æ¯å·¥ç¨‹ Â· çƒ­çˆ±ç¼–ç¨‹ä¸åˆ›æ–°<br>
        <strong>å­¦é™¢ï¼š</strong>ç”µæ°”ä¸ç”µå­å·¥ç¨‹å­¦é™¢<br>
        <strong>ç»©ç‚¹ï¼š</strong>3.2 / 5.0
        <div style="margin-top:0.8rem; text-align:left;">
          <strong>æŠ€èƒ½æ ˆï¼š</strong>
          <ul style="margin:0.5rem 0 0 1.2rem; padding:0; color:#374151; font-size:14px; text-align:left;">
            <li>ä½¿ç”¨ <strong>Cè¯­è¨€</strong> è¿›è¡Œå•ç‰‡æœºç¼–ç¨‹ (å¦‚ï¼šSTM32, 51ç³»åˆ—ç­‰)</li>
            <li>ä½¿ç”¨ <strong>Verilog HDL</strong> è¿›è¡Œ FPGA è®¾è®¡ä¸ç¼–ç¨‹</li>
            <li>ä½¿ç”¨ <strong>Java</strong> è¿›è¡Œåç«¯å¼€å‘æˆ–æ¡Œé¢åº”ç”¨ç¼–ç¨‹</li>
            <li>ç†Ÿæ‚‰ <strong>HTML, CSS, JavaScript</strong> è¿›è¡Œç½‘é¡µå¼€å‘</li>
          </ul>
        </div>
      </div>
      <div class="separator">
        <div></div>
        <span>OR</span>
        <div></div>
      </div>
      <input type="text" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°" id="nickname" name="nickname">
      <button class="oauthButton" type="button" onclick="startChat()">
        è¿›å…¥ç•™è¨€ä¸æŸ¥çœ‹ç®€å†
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 17 5-5-5-5"></path><path d="m13 17 5-5-5-5"></path></svg>
      </button>
    </form>
    <div id="leave-section" style="display:none;">
      <div class="card" id="chat-section" style="display:none;">
        <h2>ğŸ’¬ æ¬¢è¿ <span id="welcome-name"></span>ï¼è¯·ç•™è¨€ï¼š</h2>
        <label class="input-label" for="message-input">ä½ çš„ç•™è¨€ï¼š</label>
        <input class="input" placeholder="å†™ç‚¹ä»€ä¹ˆ..." type="text" id="message-input" />
        <button class="btn" onclick="submitMessage()">æäº¤ç•™è¨€</button>
        <div id="loading-animation" class="loader">
          <span class="l">L</span><span class="o">O</span><span class="a">A</span><span class="d">D</span><span class="ispan">I</span><span class="n">N</span><span class="g">G</span>
        </div>
        <div class="mt-6" id="messages"></div>
      </div>
    </div>
  </div>

    <!-- ä¸ªäººç®€ä»‹ -->
    <div class="card" id="profile-section" style="display:none;">
      <h2>å…³äºæˆ‘ - ç‹å®¶ç¿</h2>
      <p><strong>å­¦æ ¡ï¼š</strong> é‡åº†ç†å·¥å¤§å­¦</p>
      <p><strong>å­¦é™¢ï¼š</strong> ç”µæ°”ä¸ç”µå­å·¥ç¨‹å­¦é™¢</p>
      <p><strong>ä¸“ä¸šï¼š</strong> ç”µå­ä¿¡æ¯å·¥ç¨‹</p>
      <p><strong>ç»©ç‚¹ï¼š</strong> 3.2 / 5.0</p>
      <h3 class="skills-title">æŠ€èƒ½æ ˆ</h3>
      <ul class="skills-list">
        <li>ä½¿ç”¨ <strong>Cè¯­è¨€</strong> è¿›è¡Œå•ç‰‡æœºç¼–ç¨‹ (å¦‚ï¼šSTM32, 51ç³»åˆ—ç­‰)</li>
        <li>ä½¿ç”¨ <strong>Verilog HDL</strong> è¿›è¡Œ FPGA (ç°åœºå¯ç¼–ç¨‹é—¨é˜µåˆ—) è®¾è®¡ä¸ç¼–ç¨‹</li>
        <li>ä½¿ç”¨ <strong>Java</strong> è¿›è¡Œåç«¯å¼€å‘æˆ–æ¡Œé¢åº”ç”¨ç¼–ç¨‹</li>
        <li>ç†Ÿæ‚‰å‰ç«¯æŠ€æœ¯ï¼ŒåŒ…æ‹¬ <strong>HTML, CSS, JavaScript</strong> (ä»¥åŠåƒD3.jsè¿™æ ·çš„åº“) è¿›è¡Œç½‘é¡µå¼€å‘</li>
      </ul>
      <p style="margin-top: 1.5rem;">æ¬¢è¿ä¸æˆ‘äº¤æµï¼</p>
    </div>
  
  </body>
  </html>

<script>
  (function() {
    const canvas = document.getElementById("matrix-bg");
    const ctx = canvas.getContext("2d");
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;
    const fontSize = 20;
    const arr = Array(Math.ceil(width / fontSize)).fill(0);
    const str = "01".split(""); // åªåŒ…å«0å’Œ1

    function rain() {
      ctx.fillStyle = "rgba(0,0,0,0.08)";
      ctx.fillRect(0, 0, width, height);
      ctx.fillStyle = "#0f0";
      ctx.font = fontSize + "px monospace";
      arr.forEach(function (value, index) {
        ctx.fillText(str[Math.floor(Math.random() * str.length)], index * fontSize, value + fontSize);
        arr[index] = value >= height || value > 8888 * Math.random() ? 0 : value + fontSize;
      });
    }

    setInterval(rain, 80); // 80msï¼Œé€Ÿåº¦æ›´æ…¢

    window.addEventListener('resize', () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    });
  })();

  document.addEventListener('DOMContentLoaded', function() {
    var showBtn = document.getElementById('show-leave-btn');
    var leaveSection = document.getElementById('leave-section');
    if(showBtn && leaveSection) {
      showBtn.addEventListener('click', function() {
        showBtn.style.display = 'none';
        leaveSection.style.display = 'block';
      });
    }
  });
</script>
